<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="{{ url_for('static', filename='icon.png') }}" type="image/x-icon" />

    <!-- Bootstrap CSS & Jquery -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"
        integrity="sha512-3j3VU6WC5rPQB4Ld1jnLV7Kd5xr+cq9avvhwqzbH/taCRNURoeEpoPBK9pDyeukwSxwRPJ8fDgvYXd6SkaZ2TA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <script src="{{ url_for('static', filename='myjs.js') }}"></script>

    <title>BookVerse - Profile</title>
    <script>
        let user_list = {{ user_info | tojson }};
        // console.log(user_list)

        $(document).ready(function () {
            no_login();
            profile();
        });

        function profile() {
            let username = user_list['username'];
            let email = user_list['email'];
            let nohp = user_list['nohp'];
            let alamat = user_list['alamat'];
            let profile = user_list['profile_default'];

            let temp_html = `
            <div class="col-4 photo">
                <h2 class="bold mt-3 ms-1">FOTO PROFIL</h2>
                <img src="/static/${profile}" class="img-thumbnail gambar mt-3"
                    alt="Profile">
                <div class="custom-file-input ms-1 mt-4 mb-4 bold">
                    <label for="profile-user">Choose File</label>
                    <input type="file" id="profile-user" name="profile-user">
                </div>
            </div>
            <div class="col-4 ms-4 info-akun">
                <h3 class="bold mt-3">Informasi Akun</h3>
                <hr>
                <div class="mb-2">
                    <label for="inputUsername" class="form-label ps-1">Username</label>
                    <input type="email" class="form-control" id="inputUsername" value="${username}" disabled>
                </div>
                <div class="mb-2">
                    <label for="inputEmail" class="form-label ps-1">Email*</label>
                    <input type="email" class="form-control" id="inputEmail" value="${email}">
                </div>
                <div class="mb-2">
                    <label for="inputNomor" class="form-label ps-1">No HP*</label>
                    <input type="email" class="form-control" id="inputNomor" value="${nohp}">
                </div>
                <div class="mb-2">
                    <label for="inputAlamat" class="form-label ps-1">Alamat (opsional)</label>
                    <textarea class="form-control" id="inputAlamat" rows="2">${alamat}</textarea>
                </div>
                <div class="text-center">
                    <button type="button" onclick="update_profile()" class="btn mt-3 bold btn-info-save">SAVE</button>
                </div>
            </div>
            <div class="text-center mt-5">
                <button type="button" class="btn btn-lg text-center bold btn-logout" onclick="sign_out()">Log Out</button>
            </div>
            `;
            $('#editprofile').append(temp_html);
        }

        function update_profile() {
            let file = $("#profile-user")[0].files[0];
            if (!file) {
                return alert('Silahkan input photo profil');
            }
            let email = $("#inputEmail").val();
            let nomor = $('#inputNomor').val();
            let alamat = $("#inputAlamat").val();
            let form_data = new FormData();
            form_data.append("file_give", file);
            form_data.append("email_give", email);
            form_data.append("nomor_give", nomor);
            form_data.append("alamat_give", alamat);

            $.ajax({
                type: "POST",
                url: "/update_profile",
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (response) {
                    if (response["result"] === "success") {
                        alert(response["msg"]);
                        window.location.reload();
                    }
                },
            });
        }
    </script>
</head>

<body>
    <nav class="navbar navbar-expand bg-nav">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" height="55" width="200">
            </a>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <form class="d-flex">
                        <div class="form-control me-4 form-nav">
                            <input class="inp-nav" placeholder="Cari Buku" aria-label="Search" id="cari-buku" disabled>
                            <a href="#"><i class="fa fa-search fa-lg icon-src-nav" aria-hidden="true"></i></a>
                        </div>
                    </form>
                </div>
                <!-- <a class="login" style="margin-top: 3px;" href="/login"><img src="{{ url_for('static', filename='login.png') }}" alt="Icon" height="35"></a> -->
                <a href="/favorite"><i class="fa fa-heart fa-2x me-4 black" aria-hidden="true"></i></a>
                <a href="/cart"><i class="fa fa-shopping-cart fa-2x me-4 black" aria-hidden="true"></i></a>
                <a href="/profile"><i class="fa fa-user fa-2x me-2 black" aria-hidden="true"></i></a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row justify-content-center mt-5 mb-5" id="editprofile">
        </div>
    </div>
</body>

</html>